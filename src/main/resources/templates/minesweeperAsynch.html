<!DOCTYPE HTML>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/layoutGamestudio.html}"
        lang="sk">
<head>
    <!--    <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Stefan Korecko" />
        <link rel="stylesheet"
              href="/css/mines.css"
              media="screen" />-->


    <title>Gamestudio - Minesweeper</title>
</head>

<body>

<main layout:fragment="content">

    <!--/*@thymesVar id="minesweeperController" type="sk.tsystems.gamestudio.server.controller.MinesweeperController"*/-->

    <h2>Minesweeper</h2>

    <div class="minesControl">
        <span id="gameStatus"></span>

        <button id="btToOpen" class="abutton">Na otváranie</button>
        <button id="btToMark" class="abutton" >Na označovanie</button>
        <button id="btNewGame" class="abutton">Nová hra</button>
    </div>

    <section>
        <table class='minefield'>
            <tr th:each="row: ${minesweeperField}">
                <td th:each="tile: ${row}"
                    th:attr="class=${@minesweeperController.getTileClass(tile)}">
                    <a th:if="${isPlaying}" th:attr="href='/minesweeper?row='+${rowStat.index}+'&column='+${tileStat.index}">
                        <span th:text="${@minesweeperController.getTileText(tile)}"></span>
                    </a>

                    <span th:if="not ${isPlaying}" th:text="${@minesweeperController.getTileText(tile)}"></span>
                </td>
            </tr>
        </table>
    </section>

    <section id="minesweeperField"></section>

    <section>
        <h3>Najlepšie skóre</h3>
        <table class="scores">
            <thead>
            <tr>
                <th>Poradie</th>
                <th>Meno</th>
                <th>Body</th>
                <th>Dátum a čas hry</th>
            </tr>
            </thead>
            <tbody id="scoresTableBody">
            <tr th:each="score: ${bestScores}">
                <td th:text="${scoreStat.index+1}"></td>
                <td th:text="${score.username}"></td>
                <td th:text="${score.points}"></td>
                <td th:text="${score.playedOn}"></td>
            </tr>
            </tbody>
        </table>
    </section>


<script type="text/javascript">
    const getJsonUrl ="/api/score/minesweeper";
    const tableBodyElmId="scoresTableBody";

    fetchAndRenderBestScores(getJsonUrl,tableBodyElmId);

    function fetchAndRenderBestScores(getJsonUrl,tableBodyElmId) {

       fetch(getJsonUrl)  //there may be a second parameter, an object wih options, but we do not need it now.
           .then(response => {      //fetch promise fulfilled (operation completed successfully)
               if (response.ok) {    //successful execution includes an error response from the server. So we have to check the return status of the response here.
                   return response.json(); //we return a new promise with the response data as a js object, constructed from the JSON string in the response
               } else { //if we get server error
                   return Promise.reject(new Error(`Best scores acquisition failed. Server answered with ${response.status}: ${response.statusText}.`)); //we return a rejected promise to be catched later
               }
           })
           .then(bestScoresData => { //here we process the returned response data in JSON ...
               renderBestScores(bestScoresData, tableBodyElmId);
           })
           .catch(error => { ////here we process all the failed promises
               errorMessage = "Nepodarilo sa získať údaje o najlepších skóre. Podrobnosti: " + error;
               console.log(errorMessage);
               //document.getElementById(fieldElmId).innerHTML =error;
           });
    }

    function renderBestScores(bestScoresData, tableBodyElmId) {

       const rowCount = bestScoresData.length;

       let html2Render="";

       for(row=0;row<rowCount;row++){
           html2Render+=
               `<tr>
                   <td>${row+1} </td>
                   <td>${bestScoresData[row].username}</td>
                   <td>${bestScoresData[row].points}</td>
                   <td>${bestScoresData[row].playedOn}</td>
                </tr>
               `;
       }
       document.getElementById(tableBodyElmId).innerHTML=html2Render;
    }
</script>
</main>

</body>
</html>


<!--<!DOCTYPE HTML>-->
<!--<html xmlns:th="http://www.thymeleaf.org"-->
<!--      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"-->
<!--      layout:decorate="~{layout/layoutGamestudio.html}"-->
<!--      lang="sk">-->
<!--<head>-->
<!--&lt;!&ndash;    <meta charset="UTF-8" />&ndash;&gt;-->
<!--&lt;!&ndash;    <meta name="viewport" content="width=device-width, initial-scale=1">&ndash;&gt;-->
<!--&lt;!&ndash;    <meta name="author" content="Stefan Korecko" />&ndash;&gt;-->
<!--&lt;!&ndash;    <link rel="stylesheet"&ndash;&gt;-->
<!--&lt;!&ndash;          href="/css/mines.css"&ndash;&gt;-->
<!--&lt;!&ndash;          media="screen" />&ndash;&gt;-->

<!--    <title>GameStudio - Minesweeper</title>-->
<!--</head>-->

<!--<body>-->
<!--<main layout:fragment="content">-->

<!--    <h2>Minesweeper</h2>-->

<!--    <div class="minesControl">-->
<!--        <a class="abutton" href="/minesweeper/new">Nova hra</a>-->
<!--        <span th:if="${@minesweeperController.marking}">-->
<!--            Prave oznacujes-->
<!--            <a href="/minesweeper/mark">Zmen na otvaranie</a>-->
<!--        </span>-->
<!--        <span th:if="not ${@minesweeperController.marking}">-->
<!--            Prave otvaras-->
<!--            <a class="abutton" href="/minesweeper/mark">Zmen na oznacovanie</a>-->
<!--        </span>-->
<!--    </div>-->

<!--    <div class="gameState">-->
<!--        <aside th:text="${gameState}"></aside>-->
<!--    </div>-->

<!--&lt;!&ndash;    <div th:utext="${@minesweeperController.getFieldAsHtml()}"></div>&ndash;&gt;-->

<!--    <div>-->
<!--        <table class='minefield'>-->
<!--            <tr th:each="row: ${minesweeperField}">-->
<!--                <td th:each="tile: ${row}"-->
<!--                    th:attr="class=${@minesweeperController.getTileClass(tile)}">-->
<!--                    <a th:if="${@minesweeperController.play}" th:attr="href='/minesweeper?row='+${rowStat.index}+'&column='+${tileStat.index}">-->
<!--                        <span th:text="${@minesweeperController.getTileText(tile)}"></span>-->
<!--                    </a>-->

<!--                    <span th:if="not ${@minesweeperController.play}" th:text="${@minesweeperController.getTileText(tile)}"></span>-->

<!--                </td>-->
<!--            </tr>-->
<!--        </table>-->
<!--    </div>-->

<!--    <div>-->
<!--        Priemerný rating: <span th:text="${rating}"></span>-->
<!--    </div>-->
<!--    <div th:if="not ${@minesweeperController.play}">-->
<!--        <label for="rating">Pridaj svoje hodnotenie do hry:</label>-->
<!--        <form action="/minesweeper/rating" method="post">-->
<!--            <select id="rating" name="rating">-->
<!--                <option value="1">1</option>-->
<!--                <option value="2">2</option>-->
<!--                <option value="3">3</option>-->
<!--                <option value="4">4</option>-->
<!--                <option value="5">5</option>-->
<!--            </select>-->
<!--            <button type="submit">Pridaj</button> <br/>-->
<!--        </form>-->
<!--    </div>-->

<!--    <div>-->
<!--        <table class="scores">-->
<!--            <tr>-->
<!--                <th>Meno</th>-->
<!--                <th>Body</th>-->
<!--                <th>Dátum</th>-->
<!--            </tr>-->
<!--            <tr th:each="score: ${bestScores}">-->
<!--                <td th:text="${score.getUsername}"></td>-->
<!--                <td th:text="${score.getPoints}"></td>-->
<!--                <td th:text="${score.getPlayedOn}"></td>-->
<!--            </tr>-->
<!--        </table>-->
<!--    </div>-->

<!--    <br/>-->
<!--    <label for="comment">Zadaj komentár, ak sa na to cítiš:</label> <br/>-->
<!--    <form action="/minesweeper/comment" method="post">-->
<!--        <input id="comment" type="text" name="comment" maxlength="1000"/>-->
<!--        <button type="submit">Odoslať</button> <br/>-->
<!--    </form>-->

<!--    <div>-->
<!--        <table class="comments">-->
<!--            <tr>-->
<!--                <th>Meno</th>-->
<!--                <th>Komentár</th>-->
<!--                <th>Dátum</th>-->
<!--            </tr>-->
<!--            <tr th:each="comment: ${comments}">-->
<!--                <td th:text="${comment.getUsername}"></td>-->
<!--                <td th:text="${comment.getComment}"></td>-->
<!--                <td th:text="${comment.getCommentedOn}"></td>-->
<!--            </tr>-->
<!--        </table>-->
<!--    </div>-->

<!--</main>-->
<!--</body>-->
<!--</html>-->
